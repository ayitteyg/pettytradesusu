<div class="withdraw-container">
    <div class="card withdraw-card">
        <div class="card-header bg-sv-crd text-white">
            <h4 class="mb-0">Withdraw Funds</h4>
            <p class="small mb-0">Request a withdrawal from your account</p>
        </div>

        <div class="card-body">
            <!-- Balance Summary -->
            <div class="balance-summary mb-4">
                <div class="balance-item">
                    <span class="balance-label">Current Balance:</span>
                    <span class="balance-value text-success">{{ formatCurrency(currentBalance) }}</span>
                </div>

                <div class="balance-item">
                    <span class="balance-label">Upcoming Loan Deduction:</span>
                    <span class="balance-value text-danger">-{{ formatCurrency(upcomingLoanDeduction) }}</span>
                </div>

                <hr>

                <div class="balance-item">
                    <span class="balance-label">Available Balance:</span>
                    <span class="balance-value text-primary">{{ formatCurrency(availableBalance) }}</span>
                </div>

                <div class="balance-note">
                    <small class="text-muted">
            Maximum withdrawal: {{ formatCurrency(maxWithdrawalAmount) }} (80% of available balance)
          </small>
                </div>
            </div>

            <!-- Withdrawal Form -->
            <form [formGroup]="withdrawForm" (ngSubmit)="onSubmit()" *ngIf="!is_currentBalance_zero; else noFunds">
                <div class="mb-4">
                    <label class="form-label">Amount to Withdraw (GHS)</label>
                    <div class="input-group">
                        <span class="input-group-text">GHS</span>
                        <input type="number" class="form-control" formControlName="amount" placeholder="Enter amount" step="0.01">
                    </div>

                    <!-- Validation Messages -->
                    <div *ngIf="amount?.invalid && amount?.touched" class="text-danger small mt-2">
                        <div *ngIf="amount?.errors?.['required']">Amount is required</div>
                        <div *ngIf="amount?.errors?.['min']">Minimum withdrawal is GHS 1.00</div>
                        <div *ngIf="amount?.errors?.['max']">
                            Cannot withdraw more than {{ formatCurrency(maxWithdrawalAmount) }}
                        </div>
                    </div>

                    <!-- Available balance info -->
                    <div class="text-muted small mt-2">
                        Available: {{ formatCurrency(availableBalance) }}
                    </div>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary" [disabled]="withdrawForm.invalid">
            Continue to Withdraw
          </button>
                </div>
            </form>

            <ng-template #noFunds>
                <p class="text-danger">you have no funds in you savings account</p>

            </ng-template>

        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="custom-modal" *ngIf="showConfirmationModal">
        <div class="custom-modal-dialog">
            <div class="custom-modal-content">
                <div class="custom-modal-header">
                    <h5>Confirm Withdrawal</h5>
                </div>
                <div class="custom-modal-body">
                    <p>Please confirm your withdrawal details:</p>

                    <div class="withdrawal-details">
                        <div class="detail-row">
                            <span>Amount:</span>
                            <strong>{{ formatCurrency(withdrawForm.value.amount) }}</strong>
                        </div>
                        <div class="detail-row">
                            <span>From Account:</span>
                            <strong>Main Savings Account</strong>
                        </div>
                        <div class="detail-row">
                            <span>Available After:</span>
                            <strong>{{ formatCurrency(availableBalance - withdrawForm.value.amount) }}</strong>
                        </div>
                    </div>

                    <p class="text-muted small mt-3">
                        Your withdrawal will be processed ASAP.
                    </p>
                </div>
                <div class="custom-modal-footer">
                    <button type="button" class="btn btn-outline-secondary" [disabled]="isProcessing" (click)="cancelWithdrawal()">
            Cancel
          </button>
                    <button type="button" class="btn btn-primary" [disabled]="isProcessing" (click)="confirmWithdrawal()">
            <span *ngIf="!isProcessing">Confirm Withdrawal</span>
            <span *ngIf="isProcessing" class="spinner-border spinner-border-sm"></span>
          </button>
                </div>
            </div>
        </div>
    </div>
    <div class="custom-modal-backdrop" *ngIf="showConfirmationModal"></div>
</div>